> https://juejin.im/entry/6844903602805293069

鉴权：是指验证用户是否拥有访问系统的权利


## HTTP Basic Authentication
+ 浏览器遵守http协议实现的基本授权方式,
+ HTTP协议进行通信的过程中,定义了基本认证允许HTTP服务器对客户端进行用户身份证的方法

认证过程：
+ 客户端向服务器请求数据，请求的内容可能是一个网页或者是一个ajax异步请求，此时，假设客户端尚未被验证，则客户端提供如下请求至服务器:
```
    Get /index.html HTTP/1.0   Host:www.google.com
```
+ 服务器向客户端发送验证请求代码401,（`WWW-Authenticate: Basic realm=”google.com”`这句话是关键，如果没有客户端不会弹出用户名和密码输入界面）服务器返回的数据大抵如下：
```
    HTTP/1.0 401 Unauthorised
    Server: SokEvo/1.0
    WWW-Authenticate: Basic realm=”google.com”
    Content-Type: text/html
    Content-Length: xxx
```
+ 当符合http1.0或1.1规范的客户端（如IE，FIREFOX）收到401返回值时，将自动弹出一个登录窗口，要求用户输入用户名和密码。
+ 用户输入用户名和密码后，将用户名及密码以Base64加密方式加密，并将密文放入前一条请求信息中，则客户端发送的第一条请求信息则变成如下内容：
```
  Get /index.html HTTP/1.0
  Host:www.google.com
  Authorization: Basic d2FuZzp3YW5n
```
+  5． 服务器收到上述请求信息后，将Authorization字段后的用户信息取出、解密，将解密后的用户名及密码与用户数据库进行比较验证，如用户名及密码正确，服务器则根据请求，将所请求资源发送给客户端

效果：客户端未未认证的时候，会弹出用户名密码输入框，这个时候请求时属于pending状态，这个时候其实服务当用户输入用户名密码的时候客户端会再次发送带Authentication头的请求

优点：
+ 基本认证的一个优点是基本上所有流行的网页浏览器都支持基本认证。

缺点：
+ 加密方式简单，仅仅是base64加密 可逆
+ 在每个请求的头上都会附带上用户名和密码信息 在外网很容易被嗅探器探测到
+ 同样没有对服务器返回的信息提供保护

## Session-Cookie

+ 服务器在接受客户端首次访问时在服务器端创建session，
    + 然后保存session(我们可以将session保存在内存中，也可以保存在redis中，推荐使用后者)
    + 然后给这个session生成一个唯一的标识字符串,
    + 然后在响应头中种下这个唯一标识字符串
+ 签名。这一步只是对sid进行加密处理，服务端会根据这个secret密钥进行解密。（非必需步骤）
+ 浏览器中收到请求响应的时候会解析响应头，通过 Set-Cookie 头信息 将sid保存在本地cookie中，浏览器在下次http请求的请求头中会带上该域名下的cookie信息
+ 服务器在接受客户端请求时会去解析请求头cookie中的sid，然后根据这个sid去找服务器端保存的该客户端的session，然后判断该请求是否合法


## Token 验证
token 是一个令牌，浏览器第一次访问服务端时会签发一张令牌，之后浏览器每次携带这张令牌访问服务端就会认证该令牌是否有效，只要服务端可以解密该令牌，就说明请求是合法的，令牌中包含的用户信息还可以区分不同身份的用户。

一般 token 由用户信息、时间戳和由 hash 算法加密的签名构成。

### Token认证流程
1. 客户端使用用户名跟密码请求登录
2. 服务端收到请求，去验证用户名与密码
3. 验证成功后，服务端会签发一个 Token，再把这个 Token 发送给客户端
4. 客户端收到 Token 以后可以把它存储起来，比如放在 Cookie 里或者Local Storage 里
5. 客户端每次向服务端请求资源的时候需要带着服务端签发的 Token
6. 服务端收到请求，然后去验证客户端请求里面带着的 Token（request头部添加Authorization），如果验证成功，就向客户端返回请求的数据 ，如果不成功返回401错误码，鉴权失败。

### Token和session的区别
#### session-cookie的缺点：
+ （1）认证方式局限于在浏览器中使用，cookie 是浏览器端的机制，如果在app端就无法使用 cookie。
+ （2）由于服务器端需要对接大量的客户端，也就需要存放大量的 SessionId，这样会导致服务器压力过大。
+ （3）为了满足全局一致性，我们最好把 session 存储在 redis 中做持久化，而在分布式环境下，我们可能需要在每个服务器上都备份，占用了大量的存储空间。
+ （4）在不是 Https 协议下使用 cookie ，容易受到 CSRF 跨站点请求伪造攻击。
+ （5）如果服务器端是一个集群，为了同步登录态，需要将 SessionId 同步到每一台机器上，无形中增加了服务器端维护成本。

#### token的缺点：
+ （1）加密解密消耗使得 token 认证比 session-cookie 更消耗性能。
+ （2）token 比 sessionId 大，更占带宽。

####两者对比
+ （1）token 认证不局限于 cookie ，这样就使得这种认证方式可以支持多种客户端，而不仅是浏览器。且不受同源策略的影响。
+ （2）不使用 cookie 就可以规避CSRF攻击。
+ （3）token 不需要存储，token 中已包含了用户信息，服务器端变成无状态，服务器端只需要根据定义的规则校验这个 token 是否合法就行。

#### JWT
+ 基于 token 的解决方案有许多，常用的是JWT
+ JSON 对象会被服务器端签名加密后返回给用户，返回的内容就是一张令牌，以后用户每次访问服务器端就带着这张令牌。
+ 这个 JSON 对象可能包含的内容就是用户的信息，用户的身份以及令牌的过期时间。
+ 它由三部分组成：Header（头部）、Payload（负载）、Signature（签名）。


## OAuth(开放授权)
OAuth（开放授权）是一个开放标准，允许用户授权第三方网站访问他们存储在另外的服务提供者上的信息，而不需要将用户名和密码提供给第三方网站或分享他们数据的所有内容，为了保护用户数据的安全和隐私，第三方网站访问用户数据前都需要显式的向用户征求授权。我们常见的提供OAuth认证服务的厂商有支付宝，QQ,微信。

> http://lishuaishuai.com/nodejs/1167.html